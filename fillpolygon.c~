#include <FPT.h>
double WIDTH, HEIGHT;

void clickfillpoly()
{
  double p[2];
  double pointsx[100];//x-coordinates of clicked points
  double pointsy[100];//y-coordinates of clicked points
  double xpoi[100];//array of points of intersection
  int i, c, j, k, poi;
  double y, swap;
  i = 0; c = 0;
  //Create a polygon out of clicked points
  while(0==0)
    {
      G_wait_click(p);
      if(p[0]<=50&&p[1]<=50){break;}
      G_fill_rectangle(p[0]-2,p[1]-2, 4, 4);
      pointsx[i]=p[0]; pointsy[i]=p[1];
      i++; c++;
     
  }
  G_polygon(pointsx, pointsy, c);
  //loop through each row of the window
  for(y=0;y<HEIGHT;y++)
  {
  	poi=0; k=c-1;
  	//build array of intersection points
  	for(j=0; j<c; j++)
  	{
  		if((pointsy[j]<y && pointsy[k]>=y)||(pointsy[k]<y && pointsy[j]>=y))//if it intersects
  		{
  			xpoi[poi++] = ((pointsx[k]-pointsx[j])*(y-pointsy[k]))/(pointsy[k]-pointsy[j])+pointsx[k];//find x coordinate of point of intersection and put it into the array
  		}
  		k=j;
  	}
  	//sort the array
  	for(i=0;i<poi-1;i++)
  	{
  		for(j=0;j<poi-i-1;j++)
  		{
  			if(xpoi[j]>xpoi[j+1])
  			{
  				swap=xpoi[j];
  				xpoi[j]=xpoi[j+1];
  				xpoi[j+1]=swap;
  			}
  		}
  	}
  	//draw the fill lines
  	for(i=0;i<poi;i+=2)
  	{
  		G_line(xpoi[i],y,xpoi[i+1],y);
  	}
  }
  G_wait_key();
}

int main()
{
  WIDTH = 500; HEIGHT = 500;
  G_init_graphics(WIDTH, HEIGHT);
  G_rgb(0,0,0);
  G_fill_rectangle(0,0,50,50);
  G_rgb(1,0,.5);
  clickfillpoly();  
}
